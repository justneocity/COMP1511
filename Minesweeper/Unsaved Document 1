//KEEP on SIDE MINESWEEPER - WED 25 MARCH

// Assignment 1 20T1 COMP1511: Minesweeper
// minesweeper.c
//
// This program was written by RIFA JAMAL (z5311190)
// on 21/03/2020
//
// Version 1.0.0 (2020-03-08): Assignment released.
// Version 1.0.1 (2020-03-08): Fix punctuation in comment.
// Version 1.0.2 (2020-03-08): Fix second line of header comment to say minesweeper.c


#include <stdio.h>
#include <stdlib.h>

// Possible square states.
#define VISIBLE_SAFE    0
#define HIDDEN_SAFE     1
#define HIDDEN_MINE     2

// The size of the starting grid.
#define SIZE 8

// The possible command codes.
#define DETECT_ROW              1
#define DETECT_COL              2
#define DETECT_SQUARE           3
#define REVEAL_SQUARE           4
#define GAMEPLAY_MODE           5
#define DEBUG_MODE              6
#define REVEAL_RADIAL           7

// Add any extra #defines here.

void initialise_field(int minefield[SIZE][SIZE]);
void print_debug_minefield(int minefield[SIZE][SIZE]);

// Stage 1 functions to detect number of mines in row or column
void detect_mines_row(int minefield[SIZE][SIZE]);
void detect_mines_column(int minefield[SIZE][SIZE]);

//Stage 2 Functions
void detect_squares(int minefield[SIZE][SIZE]);
void reveal_square(int minefield[SIZE][SIZE], int *gameover, int mines);
int check_win(int minefield[SIZE][SIZE], int mines);

// Place your function prototyes here.

int main(void) {
    int minefield[SIZE][SIZE];
    initialise_field(minefield);
    
    int mines;
    
    // TODO: Scan in the number of pairs of mines.
    
    printf("Welcome to minesweeper!\n");
    printf("How many mines? ");
    scanf("%d", &mines);
    
    // TODO: Scan in the pairs of mines and place them on the grid.
    
    int row = 0; 
    int column = 0;
    
    printf("Enter pairs:\n");
    
    int counter = 0;
    while (counter < mines) {
        scanf("%d %d", &row, &column);
        
        if (row >= 0 && row < SIZE 
            && column >= 0 && column < SIZE) {
            minefield[row][column] = HIDDEN_MINE;
        } counter ++;
    }
    
    printf("Game Started\n");
    print_debug_minefield(minefield);  

    // TODO: Scan in commands to play the game until the game ends.
    // A game ends when the player wins, loses, or enters EOF (Ctrl+D).
    // You should display the minefield after each command has been process
    
    int row_or_column;
    //int loop_counter = 0;
    int gameover = 0;
    
    while (gameover == 0 && scanf("%d", &row_or_column) == 1) {
        if (row_or_column == DETECT_ROW) {
            detect_mines_row(minefield);  
        } else if (row_or_column == DETECT_COL) {
            detect_mines_column(minefield);
        } else if (row_or_column == DETECT_SQUARE) {
            detect_squares(minefield); 
        } else if (row_or_column == REVEAL_SQUARE) {
            reveal_square(minefield, &gameover, mines);
        }print_debug_minefield(minefield);
        //loop_counter ++;  
    }
    
    
    //Stage 2 
   /* int number;
    
    
    scanf("%d", &number);
    
    if (number == DETECT_SQUARE) {
        detect_squares(minefield); 
    } else if (number == REVEAL_SQUARE) {
        reveal_square(minefield);
    }*/


    
    //Stage 2 - check_win
    /*
    int i = 0; 
    int count = 0;
    
    while (i <= 7) {
    
        int j = 0;
        while (j <= 7) {
            if (minefield[i][j] == VISIBLE_SAFE) {
            count ++;
            }
        } check_win(minefield);
    }
    */
    return 0;      
}


void detect_mines_row(int minefield[SIZE][SIZE]) {
    
    int number;
    scanf("%d", &number);
    
    int i = 0;
    int mine = 0;
    while (i < SIZE) {
        if (minefield[number][i] == HIDDEN_MINE) {
            mine++;
        
        } 
        i++;
    } printf("There are %d mine(s) in row %d\n", mine, number);
   
}   
    
void detect_mines_column(int minefield[SIZE][SIZE]) {
    
    int number;
    scanf("%d", &number);
    int i = 0;
    int mine = 0;
    while (i < SIZE) {
        if (minefield[i][number] == HIDDEN_MINE) {
            mine++;
        } 
        i++;
    } printf("There are %d mine(s) in column %d\n", mine, number);
}
  

void detect_squares(int minefield[SIZE][SIZE]) {

    int row;
    int column;
    int size;
    scanf("%d %d %d", &row, &column, &size);
    
    
    int i = 0;
    int j = 0;
    int mine = 0;
    while (i < SIZE) {
        while (j < SIZE) {
            if (minefield[i][j] == HIDDEN_MINE) {
                mine++;
            }
        } j++;
        i++;
    } printf("There are %d mine(s) in the square centred at", mine); 
    printf("row %d, column %d of size %d \n", row, column, size);
    //print_debug_minefield(minefield);
}
/*int i = 0;
    int mine = 0;
    while (i <= size) {
        int j = 0;
        while (j <= size) {
            if (minefield[i][j] == HIDDEN_MINE) {
                mine++;
            }
        } j++;
        i++;
    } printf("There are %d mine(s) in the square centred at", mine); 
    printf("row %d, column %d of size %d \n", row, column, size);
    //print_debug_minefield(minefield); */

void reveal_square(int minefield[SIZE][SIZE], int *gameover, int mines) {

    int row;
    int col;
   
    scanf("%d %d", &row, &col);
   
    //check each separate square
   
    //case 1 = game over
    if (minefield[row][col] == HIDDEN_MINE) {
        printf("Game Over\n");
        *gameover = 1;
    } 
    
    
     
    else {
        int row_corner;
        int col_corner;
        int visible = 1;
        // check top left point
        
        row_corner = row - 1;
        col_corner = col - 1;
        if (row_corner >= 0 && col_corner >= 0) {
            if (minefield[row_corner][col_corner] == HIDDEN_MINE) {
                visible = 0;
            }
        }
        
        //upper middle point
        row_corner = row - 1;
        col_corner = col;
        if (row_corner >= 0 && col_corner >= 0) {
            if (minefield[row_corner][col_corner] == HIDDEN_MINE) {
                visible = 0;
            }
        }
        
        //upper right point
        row_corner = row - 1;
        col_corner = col + 1;
        if (row_corner >= 0 && col_corner <= 7) {
            if (minefield[row_corner][col_corner] == HIDDEN_MINE) {
                visible = 0;
            }
        }
        
        //left point
        row_corner = row;
        col_corner = col - 1;
        if (row_corner >= 0 && col_corner >= 0) {
            if (minefield[row_corner][col_corner] == HIDDEN_MINE) {
                visible = 0;
            }
        }

        //right point
        row_corner = row;
        col_corner = col + 1;
        if (row_corner >= 0 && col_corner <= 7) {
            if (minefield[row_corner][col_corner] == HIDDEN_MINE) {
                visible = 0;
            }
        }        
        
        //bottom left
        row_corner = row + 1;
        col_corner = col - 1;
        if (row_corner <= 7 && col_corner >= 0) {
            if (minefield[row_corner][col_corner] == HIDDEN_MINE) {
                visible = 0;
            }
        }
        
        //botton middle
        row_corner = row + 1;
        col_corner = col;
        if (row_corner <= 7 && col_corner <= 7) {
            if (minefield[row_corner][col_corner] == HIDDEN_MINE) {
                visible = 0;
            }
        }
        
        // bottom right
        row_corner = row + 1;
        col_corner = col + 1;
        if (row_corner <= 7 && col_corner <= 7) {
            if (minefield[row_corner][col_corner] == HIDDEN_MINE) {
                visible = 0;
            }
        }
        
        //check all points now we will print minefield - change to visible safe
        minefield[row][col] = VISIBLE_SAFE;
        if (visible == 1) {
        
            row_corner = row - 1;
            col_corner = col - 1;
            if (row_corner >= 0 && col_corner >= 0) {
                minefield[row_corner][col_corner] = VISIBLE_SAFE;
            }
        
            //upper middle point
            row_corner = row - 1;
            col_corner = col;
            if (row_corner >= 0 && col_corner >= 0) {
                minefield[row_corner][col_corner] = VISIBLE_SAFE;
            }
        
            //upper right point
            row_corner = row - 1;
            col_corner = col + 1;
            if (row_corner >= 0 && col_corner <= 7) {
                minefield[row_corner][col_corner] = VISIBLE_SAFE;
            }
        
            //left point
            row_corner = row;
            col_corner = col - 1;
            if (row_corner >= 0 && col_corner >= 0) {
                minefield[row_corner][col_corner] = VISIBLE_SAFE;
            }

            //right point
            row_corner = row;
            col_corner = col + 1;
            if (row_corner >= 0 && col_corner <= 7) {
                minefield[row_corner][col_corner] = VISIBLE_SAFE;
            }        
        
            //bottom left
            row_corner = row + 1;
            col_corner = col - 1;
            if (row_corner <= 7 && col_corner >= 0) {
                minefield[row_corner][col_corner] = VISIBLE_SAFE;
            }
        
            //botton middle
            row_corner = row + 1;
            col_corner = col;
            if (row_corner <= 7 && col_corner <= 7) {
                minefield[row_corner][col_corner] = VISIBLE_SAFE;
            }
        
            // bottom right
            row_corner = row + 1;
            col_corner = col + 1;
            if (row_corner <= 7 && col_corner <= 7) {
                minefield[row_corner][col_corner] = VISIBLE_SAFE;
            } 
        }  
    }
        
    //check_win(minefield, mines);
        
    if (check_win(minefield, mines) == 64) { //means game won
        printf("Game Won!\n");
        *gameover = 1;
    }
}       
    
   
int check_win(int minefield[SIZE][SIZE], int mines) {
    
    int i = 0;
    int j = 0;
    int count = 0;
    
    while (i < SIZE ) {
        while (j < SIZE) {
            if (minefield[i][j] == VISIBLE_SAFE) {
                count++;
            } j++;
        }
        i++;
    }
    
    int sum;
    sum = count + mines; //n = number of mines
    
    
    //printf("sum: %d\n", sum);
    //printf("count: %d\n", count);
    
    //if (sum == 64) {
    //game won   
    return sum; 
}
    
      
void initialise_field(int minefield[SIZE][SIZE]) {
    int i = 0;
    while (i < SIZE) {
        int j = 0;
        while (j < SIZE) {
            minefield[i][j] = HIDDEN_SAFE;
            j++;
        }
        i++;
    }
}

// Print out the actual values of the minefield.
void print_debug_minefield(int minefield[SIZE][SIZE]) {
    int i = 0;
    while (i < SIZE) {
        int j = 0;
        while (j < SIZE) {
            printf("%d ", minefield[i][j]);
            j++;
        }
        printf("\n");
        i++;
    }
}
